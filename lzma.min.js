//! (c) 2011 Juan Mellado | MIT License | https://github.com/jcmellado/js-lzma
//! based on "LZMA SDK" by Igor Pavlov
var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0},LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]),this._windowSize=a,this._pos=0,this._streamPos=0},LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},LZMA.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream(),this._stream=a},LZMA.OutWindow.prototype.init=function(a){a||(this._streamPos=0,this._pos=0)},LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(c<0&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a,this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.getByte=function(a){var b=this._pos-a-1;return b<0&&(b+=this._windowSize),this._buffer[b]},LZMA.RangeDecoder=function(){},LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a},LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null},LZMA.RangeDecoder.prototype.init=function(){var a=5;for(this._code=0,this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()},LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var d,b=0,c=a;c--;)this._range>>>=1,d=this._code-this._range>>>31,this._code-=this._range&d-1,b=b<<1|1-d,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return b},LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;return(2147483648^this._code)<(2147483648^d)?(this._range=d,a[b]+=2048-c>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=d,this._code-=d,a[b]-=c>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024},LZMA.BitTreeDecoder=function(a){this._models=[],this._numBitLevels=a},LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var e,b=1,c=0,d=0;d<this._numBitLevels;++d)e=a.decodeBit(this._models,b),b=b<<1|e,c|=e<<d;return c},LZMA.reverseDecode2=function(a,b,c,d){for(var h,e=1,f=0,g=0;g<d;++g)h=c.decodeBit(a,b+e),e=e<<1|h,f|=h<<g;return f},LZMA.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new LZMA.BitTreeDecoder(8),this._numPosStates=0},LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)},LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()},LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)},LZMA.Decoder2=function(){this._decoders=[]},LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)},LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(b<256);return 255&b},LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var d,e,c=1;do if(d=b>>7&1,b<<=1,e=a.decodeBit(this._decoders,(1+d<<8)+c),c=c<<1|e,d!==e){for(;c<256;)c=c<<1|a.decodeBit(this._decoders,c);break}while(c<256);return 255&c},LZMA.LiteralDecoder=function(){},LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2},LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()},LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((255&b)>>>8-this._numPrevBits)]},LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow,this._rangeDecoder=new LZMA.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new LZMA.BitTreeDecoder(4),this._lenDecoder=new LZMA.LenDecoder,this._repLenDecoder=new LZMA.LenDecoder,this._literalDecoder=new LZMA.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)},LZMA.Decoder.prototype.setDictionarySize=function(a){return!(a<0)&&(this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;return!(a>8||b>4||c>4)&&(this._literalDecoder.create(b,a),this._lenDecoder.create(d),this._repLenDecoder.create(d),this._posStateMask=d-1,!0)},LZMA.Decoder.prototype.init=function(){var a=4;for(this._outWindow.init(!1),LZMA.initBitModels(this._isMatchDecoders,192),LZMA.initBitModels(this._isRep0LongDecoders,192),LZMA.initBitModels(this._isRepDecoders,12),LZMA.initBitModels(this._isRepG0Decoders,12),LZMA.initBitModels(this._isRepG1Decoders,12),LZMA.initBitModels(this._isRepG2Decoders,12),LZMA.initBitModels(this._posDecoders,114),this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},LZMA.Decoder.prototype.decode=function(a,b,c){var k,l,m,n,o,p,d=0,e=0,f=0,g=0,h=0,i=0,j=0;for(this._rangeDecoder.setStream(a),this._outWindow.setStream(b),this.init();c<0||i<c;)if(k=i&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(d<<4)+k))l=this._literalDecoder.getDecoder(i++,j),j=d>=7?l.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(e)):l.decodeNormal(this._rangeDecoder),this._outWindow.putByte(j),d=d<4?0:d-(d<10?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,d))m=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,d)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(d<<4)+k)&&(d=d<7?9:11,m=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,d)?n=f:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,d)?n=g:(n=h,h=g),g=f),f=e,e=n),0===m&&(m=2+this._repLenDecoder.decode(this._rangeDecoder,k),d=d<7?8:11);else if(h=g,g=f,f=e,m=2+this._lenDecoder.decode(this._rangeDecoder,k),d=d<7?7:10,o=this._posSlotDecoder[m<=5?m-2:3].decode(this._rangeDecoder),o>=4){if(p=(o>>1)-1,e=(2|1&o)<<p,o<14)e+=LZMA.reverseDecode2(this._posDecoders,e-o-1,this._rangeDecoder,p);else if(e+=this._rangeDecoder.decodeDirectBits(p-4)<<4,e+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),e<0){if(e===-1)break;return!1}}else e=o;if(e>=i||e>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(e,m),i+=m,j=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c,d,e,f;return!(a.size<5)&&(b=a.readByte(),c=b%9,b=~~(b/9),d=b%5,e=~~(b/5),!!this.setLcLpPb(c,d,e)&&(f=a.readByte(),f|=a.readByte()<<8,f|=a.readByte()<<16,f+=16777216*a.readByte(),this.setDictionarySize(f)))},LZMA.decompress=function(a,b,c,d){var e=new LZMA.Decoder;if(!e.setDecoderProperties(a))throw"Incorrect stream properties";if(!e.decode(b,c,d))throw"Error in data stream";return!0},LZMA.decompressFile=function(a,b){var d,c=new LZMA.Decoder;if(!c.setDecoderProperties(a))throw"Incorrect stream properties";if(d=a.readByte(),d|=a.readByte()<<8,d|=a.readByte()<<16,d+=16777216*a.readByte(),a.readByte(),a.readByte(),a.readByte(),a.readByte(),!c.decode(a,b,d))throw"Error in data stream";return!0};
// module.exports = LZMA;